import paho.mqtt.publish as publish
import time
import json
import random

MQTT_SERVER = "127.0.0.1"
MQTT_PATH = "test"
# loc = [[77.56828308105469,13.013255041853022],[77.57583618164062,13.01392405202657],[77.58544921874999,13.015262066957186],[77.59471893310547,13.00990996390651],[77.61119842529297,13.009575453629886],[77.62218475341797,13.018941570773212],[77.63179779052733,13.021617539233338],[77.63763427734375,13.015262066957186],[77.65205383300781,13.010244473731893],[77.67574310302734,13.018272574142705],[77.68157958984375,13.025296948671429],[77.68913269042969,13.015931071714087],[77.69840240478516,13.002216113403735],[77.71659851074219,12.995860143908684],[77.72758483886719,12.974449365606928],[77.73101806640625,12.96842725192088],[77.73857116699219,12.96842725192088],[77.70904541015625,12.92894534401738],[77.67848968505858,12.930283816162502],[77.67471313476562,12.947683300542897],[77.62115478515625,12.95102921601837],[77.6084518432617,12.924260634987867],[77.59712219238281,12.900835771934787],[77.56038665771484,12.929614580987227],[77.58064270019531,12.947683300542897],[77.62630462646484,12.963743284940753],[77.64724731445311,12.970434639348912],[77.64724731445311,12.97980223312756],[77.640380859375,12.989838549012543],[77.62390136718749,12.989838549012543],[77.60467529296875,12.969765512005967],[77.57686614990234,12.968092685774835],[77.5521469116211,12.97879857924623],[77.55558013916016,12.938314498257997],[77.61634826660155,12.891799881132524],[77.65960693359375,12.901505084198375],[77.68604278564453,12.914890953258695],[77.69325256347656,12.95504425527593],[77.69050598144531,12.976791259327648],[77.67265319824219,12.99418749330745],[77.6513671875,13.022621019954595],[77.62252807617188,13.03131768257082],[77.60124206542969,13.02696938943853],[77.59471893310547,12.998870886590765],[77.57274627685547,12.982144076424275],[77.58750915527344,12.972776570874927],[77.59780883789062,12.98147498059102],[77.62424468994139,12.994522024329195],[77.6462173461914,13.000878028089785],[77.65857696533203,13.002885153354846],[77.67093658447264,13.002885153354846],[77.68123626708984,13.003219672653879],[77.69634246826172,13.00422322784486],[77.72071838378906,13.017938075150177],[77.70149230957031,13.050047918030097],[77.67677307128906,13.050716828775348],[77.65308380126953,13.048041174933985],[77.60501861572266,13.04536549213488],[77.57617950439453,13.027303876236646],[77.6077651977539,13.025965926333539],[77.74337768554688,13.00890643172299]]

while True:
    try:
        temp = random.random() + random.randint(20,25)
        humid = random.randint(20,25)
        lat = random.random() + random.randint(76, 78)
        lon = random.random() + random.randint(12, 14)

        pos = {
                "lat":lat,
                "lon":lon,
                "temp": temp,
                "humidity" : humid
                }    
            
        pos_json = json.dumps(pos)
            #pos_string = json.loads(pos_json)
        print(pos_json)
            #print(pos_string)
        
        publish.single(MQTT_PATH, pos_json, hostname=MQTT_SERVER ,port=1883)
            # msgs = [{"topic":MQTT_PATH,"payload":str(lat).encode()}, {"topic":MQTT_PATH,"payload":b","}, {"topic":MQTT_PATH,"payload":str(lon).encode()},{"topic":MQTT_PATH,"payload":b"."}]
            # publish.multiple(msgs,hostname = MQTT_SERVER)
        time.sleep(1)
    except KeyboardInterrupt:
        print("interrupt")
        break
